name: 'Publish to GitHub Pages'
description: 'Publishes lecture builds to GitHub Pages using native GitHub Pages deployment (no gh-pages branch needed)'
author: 'QuantEcon'

inputs:
  build-dir:
    description: 'Directory containing built site'
    required: true
  cname:
    description: 'Custom domain for GitHub Pages (added as CNAME file)'
    required: false
    default: ''

outputs:
  page-url:
    description: 'URL of the deployed GitHub Pages site'
    value: ${{ steps.deployment.outputs.page_url }}

runs:
  using: "composite"
  steps:
    - name: Prepare build directory
      id: prepare
      shell: bash
      run: |
        echo "Preparing build directory: ${{ inputs.build-dir }}"
        
        # Verify build directory exists
        if [ ! -d "${{ inputs.build-dir }}" ]; then
          echo "âŒ Error: Build directory not found: ${{ inputs.build-dir }}"
          exit 1
        fi
        
        # Count files
        FILE_COUNT=$(find "${{ inputs.build-dir }}" -type f | wc -l)
        echo "ğŸ“Š Files to deploy: $FILE_COUNT"
        
        # Calculate size
        SIZE=$(du -sh "${{ inputs.build-dir }}" | cut -f1)
        echo "ğŸ’¾ Total size: $SIZE"
        
        # Add CNAME file if specified
        if [ -n "${{ inputs.cname }}" ]; then
          echo "${{ inputs.cname }}" > "${{ inputs.build-dir }}/CNAME"
          echo "ğŸŒ Added CNAME: ${{ inputs.cname }}"
        fi
        
        echo "âœ… Preparation complete"

    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Upload Pages artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: ${{ inputs.build-dir }}

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: Display Deployment Info
      shell: bash
      run: |
        echo "::group::Deployment Summary"
        echo "âœ… Deployment successful!"
        echo "ğŸ“ Page URL: ${{ steps.deployment.outputs.page_url }}"
        if [ -n "${{ inputs.cname }}" ]; then
          echo "ğŸŒ Custom domain: ${{ inputs.cname }}"
        fi
        echo "::endgroup::"

branding:
  icon: 'globe'
  color: 'blue'
